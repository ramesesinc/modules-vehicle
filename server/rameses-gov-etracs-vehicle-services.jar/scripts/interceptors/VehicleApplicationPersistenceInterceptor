import com.rameses.annotations.*;
import com.rameses.util.*;

class VehicleApplicationPersistenceInterceptor {
	
	@DataContext("vehicle_permit")
	def permitEm;

	@Service("DateService")
	def dateSvc;

	@After(pattern="PersistenceService.read", eval="#{ args[0]._schemaname=='vehicle_application'}")
	public void loadPermit( def evt ) {
		def app = evt.result;
		if( app.apptype.matches('NEW|RENEW') && app.task.state.matches('release|end') ) {
			def perm = permitEm.find( [appid: app.objid ]).first();
			if(perm) app.permit = perm; 
		}
	}



}